# ============================================
# PROJETO: DASH ESTRESSE
# Isolado na rede estresse_network
# ============================================

# Aplicação Dash
location /estresse/ {
    proxy_pass http://estresse_app/;
    include /etc/nginx/includes/proxy-params.conf;
    
    # Headers específicos do Dash
    proxy_set_header X-Forwarded-Prefix /estresse;
    proxy_redirect off;
    
    # Timeouts maiores para dashboards
    proxy_read_timeout 180s;
    proxy_connect_timeout 10s;
    
    # Corrige links internos do Dash
    sub_filter_once off;
    sub_filter "href='/" "href='/estresse/";
    sub_filter 'src="/' 'src="/estresse/';
    sub_filter 'content="/' 'content="/estresse/';
    
    # Sem cache para dashboards dinâmicos
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    expires off;
}

# Redirecionamentos para o Dash
location = /estresse {
    return 301 /estresse/home;
}

location = /home {
    return 301 /estresse/home;
}

location = /formulario {
    return 301 /estresse/formulario;
}

location = /dashboard {
    return 301 /estresse/dashboard;
}
