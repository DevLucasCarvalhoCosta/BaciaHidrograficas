# ============================================
# PROJETO: ANA HIDRO
# Isolado na rede ana_network
# ============================================

# Backend API
location /api/ana/ {
    proxy_pass http://ana_backend/;
    include /etc/nginx/includes/proxy-params.conf;
    
    # Timeouts específicos para API externa
    proxy_read_timeout 90s;
    proxy_connect_timeout 10s;
    proxy_send_timeout 90s;
    
    # Headers adicionais
    proxy_set_header X-API-Path "/api/ana";
}

# Frontend SPA
location /ana/ {
    proxy_pass http://ana-frontend/;
    include /etc/nginx/includes/proxy-params.conf;
    
    # SPA fallback
    proxy_intercept_errors on;
    error_page 404 = /ana/index.html;
    
    # Cache para assets estáticos
    location ~* ^/ana/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        proxy_pass http://ana-frontend;
        include /etc/nginx/includes/proxy-params.conf;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# Redirecionar /ana para /ana/
location = /ana {
    return 301 /ana/;
}
