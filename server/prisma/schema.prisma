generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Station {
  id           String   @id @default(cuid())
  codigoestacao   String   @unique
  Estacao_Nome    String?
  Estacao_Status  String?
  Latitude        Float?
  Longitude       Float?
  UF              String?  @db.VarChar(2)
  Corpo_Hidrico   String?
  criadaEm     DateTime @default(now())
  atualizadaEm DateTime @updatedAt
}

// Inventário HIDRO (completo) — manter nomes exatamente como na ANA
model HidroStation {
  // A própria ANA usa codigoestacao (string) – usamos como chave primária
  codigoestacao                       String   @id
  Altitude                            String?
  Area_Drenagem                       String?
  Bacia_Nome                          String?
  Codigo_Adicional                    String?
  Codigo_Operadora_Unidade_UF         String?
  Data_Periodo_Climatologica_Fim      String?
  Data_Periodo_Climatologica_Inicio   String?
  Data_Periodo_Desc_Liquida_Fim       String?
  Data_Periodo_Desc_liquida_Inicio    String?
  Data_Periodo_Escala_Fim             String?
  Data_Periodo_Escala_Inicio          String?
  Data_Periodo_Piezometria_Fim        String?
  Data_Periodo_Piezometria_Inicio     String?
  Data_Periodo_Pluviometro_Fim        String?
  Data_Periodo_Pluviometro_Inicio     String?
  Data_Periodo_Qual_Agua_Fim          String?
  Data_Periodo_Qual_Agua_Inicio       String?
  Data_Periodo_Registrador_Chuva_Fim  String?
  Data_Periodo_Registrador_Chuva_Inicio String?
  Data_Periodo_Registrador_Nivel_Fim  String?
  Data_Periodo_Registrador_Nivel_Inicio String?
  Data_Periodo_Sedimento_Inicio       String?
  Data_Periodo_Sedimento_fim          String?
  Data_Periodo_Tanque_Evapo_Fim       String?
  Data_Periodo_Tanque_Evapo_Inicio    String?
  Data_Periodo_Telemetrica_Fim        String?
  Data_Periodo_Telemetrica_Inicio     String?
  Data_Ultima_Atualizacao             String?
  Estacao_Nome                         String?
  Latitude                             String?
  Longitude                            String?
  Municipio_Codigo                     String?
  Municipio_Nome                       String?
  Operadora_Codigo                     String?
  Operadora_Sigla                      String?
  Operadora_Sub_Unidade_UF             String?
  Operando                              String?
  Responsavel_Codigo                   String?
  Responsavel_Sigla                    String?
  Responsavel_Unidade_UF               String?
  Rio_Codigo                           String?
  Rio_Nome                             String?
  Sub_Bacia_Codigo                     String?
  Sub_Bacia_Nome                       String?
  Tipo_Estacao                         String?
  Tipo_Estacao_Climatologica           String?
  Tipo_Estacao_Desc_Liquida            String?
  Tipo_Estacao_Escala                  String?
  Tipo_Estacao_Piezometria             String?
  Tipo_Estacao_Pluviometro             String?
  Tipo_Estacao_Qual_Agua               String?
  Tipo_Estacao_Registrador_Chuva       String?
  Tipo_Estacao_Registrador_Nivel       String?
  Tipo_Estacao_Sedimentos              String?
  Tipo_Estacao_Tanque_evapo            String?
  Tipo_Estacao_Telemetrica             String?
  Tipo_Rede_Basica                     String?
  Tipo_Rede_Captacao                   String?
  Tipo_Rede_Classe_Vazao               String?
  Tipo_Rede_Curso_Dagua                String?
  Tipo_Rede_Energetica                 String?
  Tipo_Rede_Estrategica                String?
  Tipo_Rede_Navegacao                  String?
  Tipo_Rede_Qual_Agua                  String?
  Tipo_Rede_Sedimentos                 String?
  UF_Estacao                           String?
  UF_Nome_Estacao                      String?
  codigobacia                          String?
  criadaEm                             DateTime @default(now())
  atualizadaEm                         DateTime @updatedAt
  
  // Relações com séries de dados
  seriesTelemetricas SerieTelemetrica[]
}

// Séries Telemétricas - Dados completos da estação (estrutura real da ANA)
model SerieTelemetrica {
  id                          String       @id @default(cuid())
  codigoestacao               String
  Data_Hora_Medicao           DateTime
  Data_Atualizacao            String?
  
  // Dados de Chuva
  Chuva_Acumulada             String?
  Chuva_Acumulada_Status      String?
  Chuva_Adotada               String?
  Chuva_Adotada_Status        String?
  
  // Dados de Cota/Nível
  Cota_Sensor                 String?
  Cota_Sensor_Status          String?
  Cota_Adotada                String?
  Cota_Adotada_Status         String?
  Cota_Display                String?
  Cota_Display_Status         String?
  Cota_Manual                 String?
  Cota_Manual_Status          String?
  
  // Dados de Vazão
  Vazao_Adotada               String?
  Vazao_Adotada_Status        String?
  
  // Dados Ambientais
  Temperatura_Agua            String?
  Temperatura_Agua_Status     String?
  Temperatura_Interna         String?
  Pressao_Atmosferica         String?
  Pressao_Atmosferica_Status  String?
  
  // Dados de Equipamento
  Bateria                     String?
  
  estacao                     HidroStation @relation(fields: [codigoestacao], references: [codigoestacao], onDelete: Cascade)
  criadaEm                    DateTime     @default(now())
  
  @@unique([codigoestacao, Data_Hora_Medicao])
  @@index([codigoestacao, Data_Hora_Medicao])
}

// Log de Sincronizações
model SyncLog {
  id                   String   @id @default(cuid())
  codigoEstacao        String
  dataInicio           String   // Data de início do período sincronizado (yyyy-MM-dd)
  dataFim              String   // Data de fim do período sincronizado (yyyy-MM-dd)
  inicioExecucao       DateTime
  fimExecucao          DateTime?
  duracaoMs            Int?     // Duração em milissegundos
  totalRequisicoes     Int      @default(0)
  registrosProcessados Int      @default(0)
  erros                Int      @default(0)
  sucesso              Boolean  @default(false)
  detalhes             String?  @db.Text // JSON com detalhes da execução
  tipoSync             String?  // 'manual', 'automatico', 'rapido'
  
  criadaEm             DateTime @default(now())
  
  @@index([codigoEstacao, inicioExecucao])
  @@index([sucesso, inicioExecucao])
}

