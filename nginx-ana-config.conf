# Configuração Nginx para o Projeto ANA
# Arquivo: /etc/nginx/sites-available/patrimonioueg
# 
# Esta configuração deve ser ADICIONADA ao arquivo existente
# NÃO substitua a configuração existente do PatrimônioUEG!

# ==========================================
# ADICIONAR DENTRO DO BLOCO server {} EXISTENTE
# (que já tem SSL configurado)
# ==========================================

    # ========================================
    # PROJETO ANA (NOVO - ADICIONAR)
    # ========================================
    
    # Backend ANA (porta 3001)
    location /api/ana {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeout maior para APIs externas (ANA)
        proxy_read_timeout 60s;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        
        # Buffer settings
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
    }

    # Frontend ANA (SPA React)
    location /ana {
        alias /var/www/ana-frontend/dist;
        try_files $uri $uri/ /ana/index.html;
        index index.html;
        
        # Cache para assets estáticos
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            alias /var/www/ana-frontend/dist;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
        
        # CORS headers para Leaflet tiles
        add_header Access-Control-Allow-Origin "*";
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
    }

# ==========================================
# COMANDOS PARA APLICAR A CONFIGURAÇÃO
# ==========================================

# 1. Fazer backup da configuração atual:
# sudo cp /etc/nginx/sites-available/patrimonioueg /etc/nginx/sites-available/patrimonioueg.backup

# 2. Editar o arquivo:
# sudo nano /etc/nginx/sites-available/patrimonioueg

# 3. Adicionar a configuração acima DENTRO do bloco server {} existente
#    (após as configurações do PatrimônioUEG)

# 4. Testar a configuração (NUNCA pule este passo!):
# sudo nginx -t

# 5. Se o teste passar, recarregar o Nginx:
# sudo systemctl reload nginx

# 6. Verificar status:
# sudo systemctl status nginx

# ==========================================
# EXEMPLO DE ESTRUTURA COMPLETA
# ==========================================
# server {
#     listen 443 ssl http2;
#     server_name patrimonioueg.duckdns.org;
#     
#     # SSL config...
#     
#     # PatrimônioUEG (existente)
#     location /api { ... }
#     location /n8n { ... }
#     location / { ... }
#     
#     # Projeto ANA (NOVO)
#     location /api/ana { ... }
#     location /ana { ... }
# }
